"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[10],{171:(Et,E,d)=>{d.r(E),d.d(E,{default:()=>mt});var x=d(342),u=d(256),m=d(514),o=d(734),O=d(182),I=d(329),w=d(538),M=Object.defineProperty,B=(s,t,e)=>t in s?M(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,P=(s,t,e)=>(B(s,typeof t!="symbol"?t+"":t,e),e);const b=class D extends u.A{constructor(){var t;super({className:"chat-page__header",tag:"header"});const e=(0,o.Ln)({className:"chat-page__user-name",textContent:(t=w.A.getAuthData())==null?void 0:t.login}),i=(0,o.p)({className:"chat-page__user-info",textContent:"User:"},e),l=(0,o.h1)("chat-page__heading","Fun chat"),r=(0,o.a)({className:"chat-page__about-link button button--continue",href:`#${O.A.ABOUT}`,textContent:"About"}),c=(0,m.A)({className:"chat-page__logout-button button button--cancel",textContent:"Logout",buttonType:"button",clickHandler:D.onLogoutButtonClick}),N=(0,o.y4)({className:"chat-page__buttons"},r,c);this.appendChildren([i,l,N])}};P(b,"onLogoutButtonClick",()=>{I.A.logoutHandler()});let y=b;var p=d(368),H=Object.defineProperty,F=(s,t,e)=>t in s?H(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,v=(s,t,e)=>(F(s,typeof t!="symbol"?t+"":t,e),e);class G extends u.A{constructor(t,e,i){super({className:"chat-page__contact",tag:"li"}),v(this,"isOnline",!1),v(this,"count",0),v(this,"login",""),this.count=i,this.isOnline=e,this.login=t;const l=(0,o.y4)({className:"chat-page__contact-indicator"}),r=(0,o.Ln)({className:"chat-page__contact-name",textContent:t}),c=(0,o.Ln)({className:"chat-page__contact-counter",textContent:i.toString()});this.setAttribute("data-login",t),this.isOnline&&l.addClass("chat-page__contact-indicator--online"),this.count>0&&c.addClass("chat-page__contact-counter--shown"),this.appendChildren([l,r,c])}}var n=d(605),a=d(54),A=d(849),V=Object.defineProperty,R=(s,t,e)=>t in s?V(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,C=(s,t,e)=>(R(s,typeof t!="symbol"?t+"":t,e),e);class U extends u.A{constructor(){super({className:"chat-page__contacts",tag:"section"}),C(this,"list"),C(this,"search"),C(this,"updateContacts",()=>{const e=[...p.A.getContactsData().entries()].map(([r,c])=>new G(r,c.isOnline,c.unreadMessagesCount||0));let i=e;if(this.search.getNode().value){const r=this.search.getNode().value.toLowerCase();i=e.filter(c=>c.login.toLowerCase().startsWith(r))}const l=i.sort((r,c)=>r.isOnline===c.isOnline?r.login.localeCompare(c.login):r.isOnline?-1:1);this.list.removeChildren(),this.list.appendChildren(l)}),C(this,"addContactSelectionHandler",()=>{this.addListener("click",t=>{const e=(0,A.P8)(t,".chat-page__contact"),i=(0,A.P8)(t,".chat-page__search");if(!e&&!i)n.A.emit(a.A.CONTACT_SELECTION_CLICK,null);else if(e){const l=e.getAttribute("data-login");n.A.emit(a.A.CONTACT_SELECTION_CLICK,l)}})}),this.search=(0,o.hF)({className:"chat-page__search",type:"text",placeholder:"Search"}),this.list=(0,o.ul)({className:"chat-page__contacts-list"}),this.appendChildren([this.search,this.list]),n.A.on(a.A.CONTACTS_UPDATED,this.updateContacts),this.search.addListener("input",this.updateContacts),window.addEventListener("popstate",()=>{n.A.off(a.A.CONTACTS_UPDATED,this.updateContacts)},{once:!0}),this.addContactSelectionHandler(),this.updateContacts()}}var K=Object.defineProperty,Y=(s,t,e)=>t in s?K(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,f=(s,t,e)=>(Y(s,typeof t!="symbol"?t+"":t,e),e);const T={ONLINE:"Online",OFFLINE:"Offline"};class W extends u.A{constructor(){super({className:"dialogue__header",tag:"div"}),f(this,"login"),f(this,"activity"),f(this,"updateLogin",t=>{t?(this.login.setTextContent(t),this.activity.removeClass("dialogue__activity--hidden")):(this.login.setTextContent("No contact selected"),this.activity.addClass("dialogue__activity--hidden"))}),f(this,"updateActivity",t=>{const e=t?T.ONLINE:T.OFFLINE;this.activity.setTextContent(e),t?this.activity.addClass("dialogue__activity--online"):this.activity.removeClass("dialogue__activity--online")}),this.login=(0,o.p)({className:"dialogue__login",textContent:"No contact selected"}),this.activity=(0,o.p)({className:"dialogue__activity"}),this.appendChildren([this.login,this.activity]),n.A.on(a.A.SELECTED_LOGIN_CHANGED,this.updateLogin),n.A.on(a.A.SELECTED_ACTIVITY_CHANGED,this.updateActivity),window.addEventListener("popstate",()=>{n.A.off(a.A.SELECTED_LOGIN_CHANGED,this.updateLogin),n.A.off(a.A.SELECTED_ACTIVITY_CHANGED,this.updateActivity)},{once:!0}),this.updateActivity(p.A.getSelectedContactActivity()),this.updateLogin(p.A.getSelectedContactLogin())}}var $=Object.defineProperty,z=(s,t,e)=>t in s?$(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,X=(s,t,e)=>(z(s,typeof t!="symbol"?t+"":t,e),e);class J extends u.A{constructor(t){var e,i,l;super({className:"dialogue__item message-item",tag:"li"}),X(this,"message"),this.message=t;const r=t.from===p.A.getSelectedContactLogin()?t.from:"You",c=new Date(t.datetime).toLocaleString(),N=(e=t.status)!=null&&e.isEdited?"edited":"";let L="sent";(i=t.status)!=null&&i.isReaded?L="read":(l=t.status)!=null&&l.isDelivered&&(L="delivered");const _t=(0,o.Ln)({className:"message-item__from",textContent:r}),Ct=(0,o.Ln)({className:"message-item__time",textContent:c}),ft=(0,o.y4)({className:"message-item__header"},_t,Ct),vt=(0,o.y4)({className:"message-item__text",textContent:t.text}),At=(0,o.Ln)({className:"message-item__edited",textContent:N}),S=(0,o.Ln)({className:"message-item__status",textContent:L}),Nt=(0,o.y4)({className:"message-item__footer"},At,S),Lt=(0,o.y4)({className:"message-item__container"},ft,vt,Nt);t.to===p.A.getSelectedContactLogin()&&(S.addClass("message-item__status--shown"),this.addClass("message-item--sent")),this.append(Lt),this.setAttribute("data-id",t.id)}}var Q=Object.defineProperty,Z=(s,t,e)=>t in s?Q(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,_=(s,t,e)=>(Z(s,typeof t!="symbol"?t+"":t,e),e);class j extends u.A{constructor(t){super({className:"dialogue__popover",tag:"div"}),_(this,"deleteButton"),_(this,"editButton"),_(this,"parentElement"),_(this,"onEditButtonClick",()=>{var e;const i=(e=this.parentElement.querySelector(".message-item__text"))==null?void 0:e.textContent;n.A.emit(a.A.EDIT_BTN_CLICK,{id:this.parentElement.dataset.id,text:i}),this.removeNode()}),_(this,"onDeleteButtonClick",()=>{n.A.emit(a.A.DELETE_BTN_CLICK,this.parentElement.dataset.id),this.removeNode()}),this.parentElement=t,this.deleteButton=(0,m.A)({className:"dialogue__delete-button button button--cancel",textContent:"Delete",buttonType:"button",clickHandler:this.onDeleteButtonClick}),this.editButton=(0,m.A)({className:"dialogue__edit-button button",textContent:"Edit",buttonType:"button",clickHandler:this.onEditButtonClick}),this.getNode().style.top=`${t.offsetTop-t.offsetTop}px`,this.appendChildren([this.editButton,this.deleteButton])}}var q=Object.defineProperty,k=(s,t,e)=>t in s?q(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,h=(s,t,e)=>(k(s,typeof t!="symbol"?t+"":t,e),e);const tt=800,et=50,st=1500;class it extends u.A{constructor(){super({className:"dialogue__content",tag:"ul"}),h(this,"divider"),h(this,"isDividerVisible",!1),h(this,"isReadOnScrollBlocked",!1),h(this,"popover",null),h(this,"filler"),h(this,"isMouseOverDialogue",!1),h(this,"createDivider",()=>{const t=(0,o.Ln)({className:"dialogue__divider-text",textContent:"New messages"});this.divider.append(t)}),h(this,"handleMessages",t=>{const e=[];let i=!1;t.forEach(l=>{var r;!i&&!((r=l.status)!=null&&r.isReaded)&&l.from===p.A.getSelectedContactLogin()&&(this.createDivider(),e.push(this.divider),i=!0,this.isDividerVisible=!0),e.push(new J(l))}),this.appendChildren(e),this.scrollToLastMessage(!0)}),h(this,"updateContent",()=>{var t;if(this.removeChildren(),this.append(this.filler),this.isDividerVisible=!1,this.isMouseOverDialogue=this.getNode().matches(":hover"),p.A.getSelectedContactLogin()){const e=(t=p.A.getSelectedContactData())==null?void 0:t.messages;if(e&&e.length)this.handleMessages(e);else{const i=(0,o.li)({className:"dialogue__greeting",textContent:"No messages here yet..."});this.append(i)}}else{const e=(0,o.li)({className:"dialogue__greeting",textContent:"Select contact to start conversation"});this.append(e)}}),h(this,"scrollToLastMessage",(t=!0)=>{const e=t?"instant":"smooth",i=this.getNode().lastElementChild;i&&!this.isDividerVisible?this.scrollIntoViewWrapper(i,{behavior:e,block:"start"}):i&&this.isDividerVisible&&this.scrollIntoViewWrapper(this.divider.getNode(),{behavior:e,block:"start"})}),h(this,"scrollIntoViewWrapper",(t,e)=>{this.isReadOnScrollBlocked=!0,t.scrollIntoView(e),setTimeout(()=>{this.isReadOnScrollBlocked=!1},et)}),h(this,"userScrollHandler",(()=>{let t=!1;return()=>{!this.isReadOnScrollBlocked&&!t&&this.isMouseOverDialogue&&(n.A.emit(a.A.USER_SCROLL),t=!0,setTimeout(()=>{t=!1},st))}})()),h(this,"contextMenuHandler",t=>{var e;t.preventDefault(),this.popover&&(this.popover.removeNode(),this.popover=null);const i=(0,A.P8)(t,".message-item__container");i&&((e=i.parentElement)!=null&&e.classList.contains("message-item--sent"))&&(this.popover=new j(i.parentElement),i.parentElement.append(this.popover.getNode()),this.scrollIntoViewWrapper(this.popover.getNode(),{behavior:"smooth",block:"start"}))}),this.divider=(0,o.li)({className:"dialogue__divider"}),this.filler=(0,o.li)({className:"dialogue__filler"}),this.updateContent(),n.A.on(a.A.MSG_CONTENT_UPDATED,this.updateContent),n.A.on(a.A.SELECTED_LOGIN_CHANGED,this.updateContent),n.A.on(a.A.MESSAGE_SENT,this.scrollToLastMessage),n.A.on(a.A.MESSAGE_RECEIVED,this.scrollToLastMessage),window.addEventListener("popstate",()=>{n.A.off(a.A.MSG_CONTENT_UPDATED,this.updateContent),n.A.off(a.A.SELECTED_LOGIN_CHANGED,this.updateContent),n.A.off(a.A.MESSAGE_SENT,this.scrollToLastMessage),n.A.off(a.A.MESSAGE_RECEIVED,this.scrollToLastMessage)},{once:!0}),this.addListener("click",()=>{var t;n.A.emit(a.A.DIALOGUE_CLICK),(t=this.popover)==null||t.removeNode()}),this.addListener("scroll",this.userScrollHandler,{passive:!0}),this.addListener("wheel",this.userScrollHandler,{passive:!0}),this.addListener("contextmenu",this.contextMenuHandler),setTimeout(()=>{this.scrollToLastMessage()},tt),this.addListener("mouseenter",()=>{this.isMouseOverDialogue=!0}),this.addListener("mouseleave",()=>{this.isMouseOverDialogue=!1})}}var ot=Object.defineProperty,nt=(s,t,e)=>t in s?ot(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,g=(s,t,e)=>(nt(s,typeof t!="symbol"?t+"":t,e),e);class at extends u.A{constructor(){super({className:"dialogue__form",tag:"form"}),g(this,"input"),g(this,"sendButton"),g(this,"closeButton"),g(this,"editedMessageId",null),g(this,"addListeners",()=>{this.input.addListener("input",()=>{const t=this.input.getNode().value;this.sendButton.getNode().disabled=!t}),this.closeButton.addListener("click",this.initForm),n.A.on(a.A.SELECTED_LOGIN_CHANGED,this.initForm),n.A.on(a.A.EDIT_BTN_CLICK,this.editModeInit),window.addEventListener("popstate",()=>{n.A.off(a.A.SELECTED_LOGIN_CHANGED,this.initForm),n.A.off(a.A.EDIT_BTN_CLICK,this.editModeInit)},{once:!0})}),g(this,"initForm",()=>{this.input.getNode().value="",this.sendButton.setAttribute("disabled",""),this.closeButton.removeClass("dialogue__close-button--shown"),this.editedMessageId=null,p.A.getSelectedContactLogin()?(this.input.removeAttribute("disabled"),this.input.getNode().focus()):this.input.setAttribute("disabled","")}),g(this,"editModeInit",({id:t,text:e})=>{this.closeButton.addClass("dialogue__close-button--shown"),this.editedMessageId=t,this.input.getNode().value=e,this.input.getNode().focus()}),this.input=(0,o.hF)({className:"dialogue__input",type:"text",placeholder:"Message",required:!0}),this.sendButton=(0,m.A)({className:"dialogue__button button",textContent:"Send",buttonType:"submit"}),this.closeButton=(0,m.A)({className:"dialogue__close-button button button--cancel",textContent:"X",buttonType:"button"}),this.sendButton.getNode().disabled=!0,this.appendChildren([this.input,this.closeButton,this.sendButton]),this.sendButton.addListener("click",t=>{t.preventDefault(),this.editedMessageId?n.A.emit(a.A.SEND_EDITED_BTN_CLICK,{id:this.editedMessageId,text:this.input.getNode().value}):n.A.emit(a.A.SEND_BTN_CLICK,this.input.getNode().value),this.initForm()}),this.initForm(),this.addListeners()}}class rt extends u.A{constructor(){super({className:"chat-page__dialogue dialogue",tag:"section"});const t=new W,e=new it,i=new at;this.appendChildren([t,e,i])}}class lt extends u.A{constructor(){super({className:"chat-page__main",tag:"main"});const t=new U,e=new rt;this.appendChildren([t,e])}}const dt=d.p+"images/9146c95cad2ca60ff85e.svg";var ct=Object.defineProperty,ht=(s,t,e)=>t in s?ct(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,ut=(s,t,e)=>(ht(s,typeof t!="symbol"?t+"":t,e),e);class pt extends u.A{constructor(){super({className:"chat-page__footer",tag:"footer"}),ut(this,"rssLink");const t=(0,o.p)({className:"chat-page__year",textContent:"2024"}),e=(0,o.a)({className:"chat-page__git-link",href:"https://github.com/izy-code",textContent:"izy-code",target:"_blank"});this.rssLink=(0,o.a)({className:"chat-page__rss-link",href:"https://rs.school",target:"_blank"}),this.appendSvgNode(),this.appendChildren([t,e,this.rssLink])}appendSvgNode(){const t=document.createElementNS("http://www.w3.org/2000/svg","use"),e=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("chat-page__rss-link-use"),e.classList.add("chat-page__rss-link-svg"),t.setAttribute("href",`${dt}#icon`),t.setAttribute("aria-hidden","true"),e.setAttribute("width","100px"),e.setAttribute("height","30px"),e.setAttribute("role","img"),e.setAttribute("aria-label","RS School Logo"),e.append(t),this.rssLink.getNode().append(e)}}var gt=d(144);class mt extends x.A{constructor(t){super(t),this.addClass("chat-page");const e=new y,i=new lt,l=new pt,r=new gt.A;this.appendChildren([e,i,l,r])}}}}]);
